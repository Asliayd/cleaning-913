<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Temizlik Takvimi</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#fff5f8;--card:#ffffff;--accent:#ff6fa8;--muted:#6b7280;--ok:#16a34a}
  body{font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);margin:0;padding:24px;display:flex;justify-content:center}
  .wrap{width:980px;max-width:100%;display:flex;gap:18px}
  .calendar{flex:1;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
  .side{width:320px;min-width:240px;background:linear-gradient(180deg,#fff,#fff3f8);padding:16px;border-radius:12px;border:1px solid rgba(255,111,168,0.08)}
  h2{margin:0 0 12px 0;font-size:18px;color:#42275a}
  .cleanDay{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;margin-bottom:8px;background:#fff0f6;border:1px solid rgba(255,111,168,0.12)}
  .person{font-weight:700;color:var(--accent);margin-right:8px}
  .date{color:var(--muted)}
  .chk{width:18px;height:18px;accent-color:var(--accent)}
  .needsHeader{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .needItem{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.04);margin-bottom:8px}
  .needInput{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,111,168,0.25)}
  .addBtn{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  @media(max-width:920px){.wrap{flex-direction:column}.side{width:100%}}
</style>
</head>
<body>
<div class="wrap">
  <div class="calendar card">
    <h2>Aralık – Ocak Temizlik Takvimi</h2>
    <div id="takvimArea"></div>
  </div>

  <div class="side">
    <div class="needsHeader"><strong>İhtiyaç Listesi</strong><span class="muted">(tikleyip tamamla)</span></div>
    <div id="needsContainer"></div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <input id="needInput" class="needInput" placeholder="Yeni ihtiyaç...">
      <button class="addNeedBtn" id="addNeedBtn">Ekle</button>
    </div>
    <div style="margin-top:12px" class="muted">Not: Tüm işaretler tarayıcıda saklanır.</div>
  </div>
</div>

<!-- FIREBASE EKLENDİ -->
<script type="module">
  // Firebase core
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

  // Senin config'in
  const firebaseConfig = {
    apiKey: "AIzaSyAS1ThvUGRZWAsSXTAArHsK3DI_6lhNyIk",
    authDomain: "cleanind-91.firebaseapp.com",
    databaseURL: "https://cleanind-91-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "cleanind-91",
    storageBucket: "cleanind-91.firebasestorage.app",
    messagingSenderId: "227420178324",
    appId: "1:227420178324:web:41fee1632d8217a0573181",
    measurementId: "G-4CHKENMCSM"
  };

  // Başlat
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ---------- Konfig ----------
  const NAMES = ["Tülin","Aslı","Ebrar","İrem","Ziyade"];
  const START_ISO = "2025-12-01";
  const INTERVAL = 5;
  const END_ISO = "2026-01-31";

  // Yerelleri silmiyoruz ama Firebase öncelikli
  let done = {};
  let needs = [];

  // Firebase listener → gerçek zamanlı güncelleme
  onValue(ref(db, "cleaning/done"), snap => {
    done = snap.val() || {};
    renderCalendar();
  });

  onValue(ref(db, "cleaning/needs"), snap => {
    needs = snap.val() || [];
    renderNeeds();
  });

  // Firebase'e yaz
  function fbSet(path, data) {
    return set(ref(db, "cleaning/" + path), data);
  }

  const toISO = d => d.toISOString().slice(0,10);
  const parseISO = s => new Date(s + 'T00:00:00');
  const addDays = (d,n)=>{const x=new Date(d);x.setDate(x.getDate()+n);return x};

  function generateCleaningDates(startISO, interval, endISO){
    const start = parseISO(startISO);
    const end = parseISO(endISO);
    const list = [];
    let cur = new Date(start);
    let i = 0;
    while(cur <= end){
      list.push({date: toISO(cur), name: NAMES[i % NAMES.length]});
      i++;
      cur = addDays(start, i * interval);
    }
    return list;
  }

  function renderCalendar(){
    const area = document.getElementById('takvimArea');
    area.innerHTML = '';
    const list = generateCleaningDates(START_ISO, INTERVAL, END_ISO);

    list.forEach(item=>{
      const row = document.createElement('div');
      row.className = 'cleanDay';

      const left = document.createElement('div');
      left.style.display = 'flex';
      left.style.alignItems = 'center';

      const cb = document.createElement('input');
      cb.type = 'checkbox'; cb.className = 'chk'; cb.dataset.date = item.date;
      cb.checked = !!done[item.date];
      cb.addEventListener('change', e=>{
        if(e.target.checked) done[item.date]=true;
        else delete done[item.date];
        fbSet("done", done);
      });

      const txt = document.createElement('div');
      txt.innerHTML = `<span class="person">${item.name}</span> <span class="date">${formatDate(item.date)}</span>`;
      txt.style.marginLeft = '10px';

      left.appendChild(cb);
      left.appendChild(txt);

      row.appendChild(left);

      const status = document.createElement('div');
      status.className = 'muted';
      status.textContent = done[item.date] ? 'Tamamlandı' : '';
      row.appendChild(status);

      area.appendChild(row);
    });
  }

  function renderNeeds(){
    const container = document.getElementById('needsContainer');
    container.innerHTML = '';
    needs.forEach((n,i)=>{
      const item = document.createElement('div');
      item.className = 'needItem';

      const left = document.createElement('div');
      left.style.display='flex'; left.style.alignItems='center';

      const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!n.done; cb.className='chk';
      cb.addEventListener('change', ()=>{
        needs[i].done = cb.checked;
        fbSet("needs", needs);
      });

      const txt = document.createElement('div'); txt.textContent = n.text; txt.style.marginLeft='8px';
      if(n.done) txt.style.textDecoration = 'line-through';

      left.appendChild(cb); left.appendChild(txt);

      item.appendChild(left);

      const del = document.createElement('button'); 
      del.textContent='Sil'; 
      del.style.background='transparent'; 
      del.style.border='0'; 
      del.style.color='var(--muted)'; 
      del.style.cursor='pointer';
      del.addEventListener('click', ()=>{
        needs.splice(i,1);
        fbSet("needs", needs);
      });

      item.appendChild(del);
      container.appendChild(item);
    });
  }

  function addNeed(){
    const inp = document.getElementById('needInput');
    const v = inp.value.trim(); 
    if(!v) return; 
    needs.push({text:v, done:false}); 
    inp.value='';
    fbSet("needs", needs);
  }

  function formatDate(iso){
    const d = parseISO(iso);
    return d.toLocaleDateString('tr-TR', {weekday:'short', day:'numeric', month:'long'});
  }

  document.getElementById('addNeedBtn').addEventListener('click', addNeed);
  document.getElementById('needInput').addEventListener('keyup', e=>{ if(e.key==='Enter') addNeed(); });

</script>

</body>
</html>
